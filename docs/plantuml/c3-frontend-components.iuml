@startuml
!define GCPPuml https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist
!include GCPPuml/GCPC4Integration.puml
!include GCPPuml/IconPack.puml

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Frontend Web App Components (Energy Compliance Analyzer)

package "User Interface (React Components)" {
    Component(authUI, "Authentication UI", "Login/Logout buttons, Profile display")
    Component(fileUploadUI, "Upload UI", "Form for CSV upload, title, description")
    Component(analysisListUI, "Analysis Listing UI", "Displays past analyses (accordion)")
    Component(analysisViewUI, "Analysis View UI", "Shows details of one analysis (progress/results, tags, actions)")
    Component(reportViewUI, "Report View UI", "Renders MDX report content")
    Component(reportChatUI, "Report Chat UI", "Interface for user-AI chat about a report")
    Component(uiComponents, "Reusable UI Library (ShadCN)", "Buttons, Cards, Inputs, etc.")
}

package "State & Logic" {
    Component(stateMgmt, "State & UI Logic", "React Contexts (Auth), Custom Hooks (useAnalysisManager, useFileUploadManager), Toast Notifications")
    Component(routing, "Routing (Next.js App Router)", "Manages navigation and URL mapping")
    Component(firebaseClient, "Firebase Client Config", "Initializes Firebase SDK (Auth, Firestore, Storage, RTDB), Emulator Connect")
}

System_Ext(browser, "User's Web Browser")
Container_Ext(serverActions, "Backend API (Next.js Server Actions)", "Handles API requests")
ContainerDb_Ext(firebaseAuth, "Firebase Authentication")
ContainerDb_Ext(firebaseRTDB, "Firebase RTDB", "Chat messages")

Rel(browser, authUI, "Interacts with")
Rel(browser, fileUploadUI, "Interacts with")
Rel(browser, analysisListUI, "Views")
Rel(browser, analysisViewUI, "Views/Interacts with")
Rel(browser, reportViewUI, "Views")
Rel(browser, reportChatUI, "Interacts with")

Rel(authUI, stateMgmt, "Uses AuthContext")
Rel(fileUploadUI, stateMgmt, "Uses useFileUploadManager")
Rel(analysisListUI, stateMgmt, "Uses useAnalysisManager")
Rel(analysisViewUI, stateMgmt, "Uses useAnalysisManager")
Rel(reportViewUI, stateMgmt, "Uses state for MDX, structured report")
Rel(reportChatUI, stateMgmt, "Uses state for messages")

Rel(authUI, firebaseClient, "Uses Firebase Auth SDK")
Rel(reportChatUI, firebaseClient, "Uses Firebase RTDB SDK")
Rel(stateMgmt, firebaseClient, "Uses Firebase SDKs (indirectly via hooks)")

Rel(stateMgmt, serverActions, "Invokes actions for data operations")
Rel(reportChatUI, serverActions, "Invokes chat orchestrator action")

Rel(firebaseClient, firebaseAuth, "Connects to")
Rel(firebaseClient, firebaseRTDB, "Connects to")

@enduml