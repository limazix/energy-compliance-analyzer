
@startuml C2 - Container Overview - Energy Compliance Analyzer
!define GCP_SPRITES_LOCATION https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist
!include https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist/GCPC4Integration.puml

' Include necessary GCP icon sets
!include https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist/Firebase/FirebasePlatform.puml
!include https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist/Identity/FirebaseAuthentication.puml
!include https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist/Databases/Firestore.puml
!include https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist/Databases/FirebaseRealtimeDatabase.puml
!include https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist/Storage/CloudStorage.puml
!include https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist/Compute/CloudFunctions.puml
!include https://raw.githubusercontent.com/Crashedmind/PlantUML-icons-GCP/master/dist/AI_Machine_Learning/VertexAI.puml

skinparam {
    HyperlinkColor #3F51B5
    FontName Inter, SansSerif
    shadowing false
    RoundCorner 20
    BackgroundColor #F0F2F5
    ArrowColor #555555
    ArrowThickness 1.5
    Person { BackgroundColor #E3F2FD; BorderColor #3F51B5; }
    System { BackgroundColor #FFF3E0; BorderColor #FF9800; }
    System_Ext { BackgroundColor #ECEFF1; BorderColor #78909C; }
    Container { BackgroundColor #E8EAF6; BorderColor #3F51B5; FontColor #1A237E; }
    ContainerDb { BackgroundColor #C5CAE9; BorderColor #303F9F; FontColor #1A237E; }
    Boundary { BorderColor #BDBDBD; BackgroundColor #FAFAFA; FontStyle plain; FontColor #424242; }
}
LAYOUT_WITH_LEGEND()

title Container Overview for Energy Compliance Analyzer

Person(User, "User", "Energy sector professional")
System_Ext(GeminiAPI, "Google AI (Gemini)", "Provides LLM capabilities for analysis and chat.", $sprite=$vertex_ai)
System_Ext(AneelRegs, "ANEEL Regulations", "External source of compliance standards.")

System_Boundary(eca_system, "Energy Compliance Analyzer") {
    Container(WebApp, "Frontend Web App", "Next.js, React", "Provides UI for data upload, analysis viewing, and report interaction.", $sprite=$firebase_platform)
    Container(ServerActions, "Backend API (Next.js Server Actions)", "Node.js", "Handles API requests, file upload orchestration, chat AI, and triggers background processing.", $sprite=$firebase_platform)
    Container(FirebaseAuth, "Authentication Service", "Firebase Authentication", "Manages user identity and sessions via Google Sign-In.", $sprite=$firebase_auth)
    ContainerDb(FirestoreDB, "Main Database", "Firebase Firestore", "Stores analysis metadata, status, tags, and structured reports.", $sprite=$firestore)
    ContainerDb(RTDB, "Chat Database", "Firebase Realtime DB", "Stores chat history for interactive reports.", $sprite=$firebase_realtime_database)
    ContainerDb(FileStorage, "File Storage", "Firebase Storage", "Stores uploaded CSVs and generated MDX reports.", $sprite=$cloud_storage)
    Container(BackgroundFunctions, "Background Processing", "Firebase Functions", "Executes AI pipeline for data analysis and report generation.", $sprite=$cloud_functions)
}

User -> WebApp : Uses
WebApp -> ServerActions : Makes API calls
ServerActions -> FirebaseAuth : Authenticates User
ServerActions -> FirestoreDB : Reads/Writes Analysis Data
ServerActions -> RTDB : Manages Chat History
ServerActions -> FileStorage : (Indirectly, via client or for report paths)
ServerActions -> BackgroundFunctions : Triggers Processing (via Firestore)
ServerActions -> GeminiAPI : (For Report Chat AI)

BackgroundFunctions -> FileStorage : Reads CSVs, Writes MDX
BackgroundFunctions -> FirestoreDB : Updates Analysis Status/Results
BackgroundFunctions -> GeminiAPI : (For Data Analysis & Report Generation)

FirestoreDB ..> AneelRegs : (Conceptually) Data is validated against rules derived from ANEEL.
GeminiAPI ..> AneelRegs : (Conceptually) AI models use knowledge of ANEEL regulations.

@enduml

    