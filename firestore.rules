rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Permite que um usuário autenticado realize todas as operações de leitura (get, list)
    // e todas as operações de escrita (create, update, delete)
    // em seus próprios documentos e subcoleção de 'analyses'.
    // O curinga {doc=**} aplica a regra a todos os documentos e subcoleções aninhadas
    // sob /users/{userId}/analyses.
    match /users/{userId}/analyses/{doc=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
